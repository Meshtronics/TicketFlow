# 🚧  Ticket 2025-06-16-002 — UI Upgrades

<!--
Ticket ID naming convention: YYYY-MM-DD-###_<slug>.md
Place this file in: tickets/open/
-->

# Upgrade Streamlit UI with Full CRUD & Ticket Filters

| Field | Value |
|-------|-------|
| **Ticket ID** | 2025‑06‑16‑002 |
| **Created By** | Reasoning Model (GPT‑4‑o) |
| **Created On** | 2025‑06‑16 |
| **Priority** | High |
| **Status** | Open |

---

## 1. Background / Problem Statement
The current Streamlit UI (`ticketflow/gui/app.py`) can **only list and view** tickets.  
For TicketFlow to serve non‑CLI users—and to demonstrate parity with the CLI—we need:

* A **cleaner list view** that distinguishes **Open** vs **Archived** tickets without duplicating code.  
* Full **CRUD** operations (Create, Read, Update, “Delete” → archive) directly from the UI.  
* In‑UI ability to **close / reopen** tickets and (optionally) **sync with GitHub Issues** the same way our CLI scripts do.  

All UI actions **must call the same underlying Python functions** that the CLI uses (`new_ticket`, `move_ticket`, upcoming `score_ticket`, etc.) to avoid logic drift.

---

## 2. Objectives / Goals
1. **Refactor UI layout** to let users quickly switch between Open and Archived tickets (tabbed panes, segmented control, or dropdown filter).  
2. Provide **Create** dialog that leverages `ticketflow/scripts/new_ticket.py` under the hood.  
3. Implement **Edit** functionality with a Markdown editor (e.g. `st.text_area`) that writes updates back to the file.  
4. Implement **Archive / Reopen** buttons that call `move_ticket.py` (archive) or the inverse (restore).  
5. When creating or closing a ticket in the UI, allow user to **toggle “Sync with GitHub Issue”**:  
   * If checked on Create → call issue‑creation helper (existing or new).  
   * If checked on Close → close the linked Issue.  
6. Maintain CLI parity: no new business logic should live exclusively in the UI layer.  

---

## 3. Proposed UI Design
┌───────────────────────────── Streamlit App ──────────────────────────────┐
│ [ 🟢 Open ▾ | 📁 Archived ▾ ] (tab or radio filter) │
│ │
│ ▷ Ticket Table (ID · Title · Score · Priority · GitHub? · Buttons) │
│ [View] [Edit] [Archive/Restore] │
│ │
│ + New Ticket (opens modal) │
└──────────────────────────────────────────────────────────────────────────┘
* **Open / Archived toggle** shares one table component; only the underlying dataframe is filtered.  
* **Score** column (from ticket‑quality feature) shows colour‑coded badge.  
* **Modal dialogs** (Streamlit `st.dialog` or `st.experimental_(modal)`) for Create & Edit.

---

## 4. Implementation Plan
1. **Refactor `app.py`**
   * Introduce `load_tickets(status)` utility → returns list of dicts (reuse current file‑parsing).
   * Reuse dataframe/table component; apply filter (`open/` vs `archive/` path).
2. **Create Ticket**
   * “+ New Ticket” button → modal with title, priority, initial body, GitHub Issue checkbox.
   * On submit: call `ticketflow.new_ticket(title, body, priority, github_issue=bool)`.
3. **Edit Ticket**
   * “Edit” action loads ticket body into `st.text_area`.
   * Save writes new content (`path.write_text(...)`) then calls `build_index.py` to refresh list.
4. **Archive / Restore**
   * “Archive” button → call `ticketflow.move_ticket(ticket_id, archive=True, close_issue=checkbox)`.
   * “Restore” (in Archived tab) reverses move; optionally reopen Issue.
5. **Shared Helpers**
   * Pull common business logic from CLI scripts into **`ticketflow/core.py`** so both CLI & UI import the same functions.  
   * Update CLI scripts to import from `ticketflow.core` (no behaviour change).
6. **GitHub Sync**
   * Reuse existing helper (`github_sync.py`) if present; else create minimal wrapper using `PyGithub`.
   * Store Issue URL in ticket YAML front‑matter (add if not already).
7. **Testing**
   * Add Streamlit component tests via `pytest‑streamlit` (basic smoke tests).  
   * Refactor core functions to be pure Python, unit‑testable without Streamlit context.
8. **Docs**
   * Update `README.md` and `docs/UI.md` with screenshots & workflows.

---

## 5. Acceptance Criteria
- [ ] Streamlit UI displays **Open** and **Archived** tickets in separate views with shared component.  
- [ ] Creating a ticket in UI results in a new Markdown file identical to CLI output; optional GitHub Issue created when checkbox selected.  
- [ ] Editing in UI updates the underlying file and reflects immediately in list.  
- [ ] Archiving from UI moves file to `tickets/archive/`, updates index, and (optionally) closes Issue.  
- [ ] Restoring re‑moves ticket to `tickets/open/` and reopens Issue if desired.  
- [ ] All ticket operations invoke functions residing in `ticketflow/core.py`; CLI commands are thin wrappers.  
- [ ] Unit & smoke tests pass in CI.  

---

## 6. Related Files / Modules
| Path | Purpose |
|------|---------|
| `ticketflow/gui/app.py` | Streamlit front‑end – refactor & expand |
| `ticketflow/core.py` | **(new)** shared business logic for tickets |
| `ticketflow/scripts/` | Update to import from `core.py` |
| `ticketflow/github_sync.py` | Wrap GitHub Issue API (existing or new) |
| `tests/` | Add tests for core functions & UI smoke checks |
| `.github/workflows/ci.yml` | Ensure UI tests run (headless) |

---

## 7. Out of Scope
* Fancy WYSIWYG Markdown editor – plain text area is acceptable for MVP.  
* Real‑time multi‑user editing or auth; Streamlit app assumes trusted local usage for now.  
* Deep UI theming; keep default Streamlit theme with minor tweaks.

---

## 8. Notes
* Leverage Streamlit’s `st.tabs()` or `st.radio()` for Open vs Archived.  
* Ensure the new UI still runs with `ticketflow gui` CLI entry‑point.  
* Consider caching parsed ticket metadata to speed list loads; invalidate on file write.

---

## 9. References
* TicketFlow README – “Extending TicketFlow: Streamlit GUI” section.  
* Existing `new_ticket.py`, `move_ticket.py`, `build_index.py` scripts for behavioural parity.  
* Ticket **2025‑06‑16‑001** (quality scoring) for displaying scores in table.

---

> **Blocking ??** – None. Design approved → hand off to coding model.

---
