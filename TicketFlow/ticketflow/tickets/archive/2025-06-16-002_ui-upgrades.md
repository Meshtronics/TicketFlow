# ðŸš§  Ticket 2025-06-16-002 â€” UI Upgrades

<!--
Ticket ID naming convention: YYYY-MM-DD-###_<slug>.md
Place this file in: tickets/open/
-->

# Upgrade Streamlit UI with Full CRUD & Ticket Filters

| Field | Value |
|-------|-------|
| **Ticketâ€¯ID** | 2025â€‘06â€‘16â€‘002 |
| **Createdâ€¯By** | ReasoningÂ ModelÂ (GPTâ€‘4â€‘o) |
| **Createdâ€¯On** | 2025â€‘06â€‘16 |
| **Priority** | High |
| **Status** | Open |

---

## 1. Background / Problem Statement
The current Streamlit UI (`ticketflow/gui/app.py`) can **only list and view** tickets.  
For TicketFlow to serve nonâ€‘CLI usersâ€”and to demonstrate parity with the CLIâ€”we need:

* A **cleaner list view** that distinguishes **Open** vs **Archived** tickets without duplicating code.  
* Full **CRUD** operations (Create, Read, Update, â€œDeleteâ€ â†’ archive) directly from the UI.  
* Inâ€‘UI ability to **close / reopen** tickets and (optionally) **sync with GitHub Issues** the same way our CLI scripts do.  

All UI actions **must call the same underlying Python functions** that the CLI uses (`new_ticket`, `move_ticket`, upcoming `score_ticket`, etc.) to avoid logic drift.

---

## 2. Objectives / Goals
1. **Refactor UI layout** to let users quickly switch between Open and Archived tickets (tabbed panes, segmented control, or dropdown filter).  
2. Provide **Create** dialog that leverages `ticketflow/scripts/new_ticket.py` under the hood.  
3. Implement **Edit** functionality with a Markdown editor (e.g. `st.text_area`) that writes updates back to the file.  
4. Implement **Archive / Reopen** buttons that call `move_ticket.py` (archive) or the inverse (restore).  
5. When creating or closing a ticket in the UI, allow user to **toggle â€œSync with GitHub Issueâ€**:  
   * If checked on Create â†’ call issueâ€‘creation helper (existing or new).  
   * If checked on Close â†’ close the linked Issue.  
6. Maintain CLI parity: no new business logic should live exclusively in the UI layer.  

---

## 3. Proposed UI Design
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Streamlit App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ ðŸŸ¢ Open â–¾ | ðŸ“ Archived â–¾ ] (tab or radio filter) â”‚
â”‚ â”‚
â”‚ â–· Ticket Table (ID Â· Title Â· Score Â· Priority Â· GitHub? Â· Buttons) â”‚
â”‚ [View] [Edit] [Archive/Restore] â”‚
â”‚ â”‚
â”‚ + New Ticket (opens modal) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
* **Open / Archived toggle** shares one table component; only the underlying dataframe is filtered.  
* **Score** column (from ticketâ€‘quality feature) shows colourâ€‘coded badge.  
* **Modal dialogs** (Streamlit `st.dialog` or `st.experimental_(modal)`) for Create & Edit.

---

## 4. Implementation Plan
1. **Refactor `app.py`**
   * Introduce `load_tickets(status)` utility â†’ returns list of dicts (reuse current fileâ€‘parsing).
   * Reuse dataframe/table component; apply filter (`open/` vs `archive/` path).
2. **Create Ticket**
   * â€œ+ New Ticketâ€ button â†’ modal with title, priority, initial body, GitHub Issue checkbox.
   * On submit: call `ticketflow.new_ticket(title, body, priority, github_issue=bool)`.
3. **Edit Ticket**
   * â€œEditâ€ action loads ticket body into `st.text_area`.
   * Save writes new content (`path.write_text(...)`) then calls `build_index.py` to refresh list.
4. **Archive / Restore**
   * â€œArchiveâ€ button â†’ call `ticketflow.move_ticket(ticket_id, archive=True, close_issue=checkbox)`.
   * â€œRestoreâ€ (in Archived tab) reverses move; optionally reopen Issue.
5. **Shared Helpers**
   * Pull common business logic from CLI scripts into **`ticketflow/core.py`** so both CLI & UI import the same functions.  
   * Update CLI scripts to import from `ticketflow.core` (no behaviour change).
6. **GitHub Sync**
   * Reuse existing helper (`github_sync.py`) if present; else create minimal wrapper using `PyGithub`.
   * Store Issue URL in ticket YAML frontâ€‘matter (add if not already).
7. **Testing**
   * Add Streamlit component tests via `pytestâ€‘streamlit` (basic smoke tests).  
   * Refactor core functions to be pure Python, unitâ€‘testable without Streamlit context.
8. **Docs**
   * Update `README.md` and `docs/UI.md` with screenshots & workflows.

---

## 5. Acceptance Criteria
- [ ] Streamlit UI displays **Open** and **Archived** tickets in separate views with shared component.  
- [ ] Creating a ticket in UI results in a new Markdown file identical to CLI output; optional GitHub Issue created when checkbox selected.  
- [ ] Editing in UI updates the underlying file and reflects immediately in list.  
- [ ] Archiving from UI moves file to `tickets/archive/`, updates index, and (optionally) closes Issue.  
- [ ] Restoring reâ€‘moves ticket to `tickets/open/` and reopens Issue if desired.  
- [ ] All ticket operations invoke functions residing in `ticketflow/core.py`; CLI commands are thin wrappers.  
- [ ] Unit & smoke tests pass in CI.  

---

## 6. Related Files / Modules
| Path | Purpose |
|------|---------|
| `ticketflow/gui/app.py` | Streamlit frontâ€‘end â€“ refactor & expand |
| `ticketflow/core.py` | **(new)** shared business logic for tickets |
| `ticketflow/scripts/` | Update to import from `core.py` |
| `ticketflow/github_sync.py` | Wrap GitHub Issue API (existing or new) |
| `tests/` | Add tests for core functions & UI smoke checks |
| `.github/workflows/ci.yml` | Ensure UI tests run (headless) |

---

## 7. Out of Scope
* Fancy WYSIWYG Markdown editor â€“ plain text area is acceptable for MVP.  
* Realâ€‘time multiâ€‘user editing or auth; Streamlit app assumes trusted local usage for now.  
* Deep UI theming; keep default Streamlit theme with minor tweaks.

---

## 8. Notes
* Leverage Streamlitâ€™s `st.tabs()` or `st.radio()` for Open vs Archived.  
* Ensure the new UI still runs with `ticketflow gui` CLI entryâ€‘point.  
* Consider caching parsed ticket metadata to speed list loads; invalidate on file write.

---

## 9. References
* TicketFlow README â€“ â€œExtending TicketFlow: Streamlit GUIâ€ section.  
* Existing `new_ticket.py`, `move_ticket.py`, `build_index.py` scripts for behavioural parity.  
* Ticket **2025â€‘06â€‘16â€‘001** (quality scoring) for displaying scores in table.

---

> **Blockingâ€¯??** â€“ None. Design approved â†’ hand off to coding model.

---
